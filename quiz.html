<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<title>ê³µë¶€ í€´ì¦ˆ (ìë™ ë¶ˆëŸ¬ì˜¤ê¸° ë²„ì „)</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  body { font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:#f3f6fb; color:#1f2937; padding:22px; }
  .container{ max-width:900px; margin:24px auto; background:white; padding:22px; border-radius:12px; box-shadow:0 6px 24px rgba(16,24,40,0.08); }
  h1{ margin:0 0 10px 0; font-size:22px; }
  .controls{ display:flex; gap:8px; flex-wrap:wrap; margin:12px 0; }
  button{ padding:10px 14px; border-radius:8px; border:0; cursor:pointer; font-weight:600; }
  .btn-primary{ background:#2563eb; color:white; }
  .btn-success{ background:#16a34a; color:white; }
  .btn-danger{ background:#dc2626; color:white; }
  .btn-muted{ background:#e5e7eb; color:#111827; }
  pre{ white-space:pre-wrap; text-align:left; background:#f8fafc; padding:16px; border-radius:8px; font-size:16px; }
  #answer { margin-top:10px; font-weight:700; color:#0f172a; }
  .meta{ font-size:13px; color:#6b7280; margin-top:8px; }
</style>
</head>
<body>
  <div class="container">
    <h1>ê³µë¶€ í€´ì¦ˆ â€” ìë™ ë¡œë“œ ë²„ì „</h1>
    <p class="meta">ê°™ì€ í´ë”ì˜ <code>ê³µë¶€.txt</code>ì™€ <code>ì •ë‹µ.txt</code>ê°€ ìë™ìœ¼ë¡œ ë¶ˆëŸ¬ì™€ì§‘ë‹ˆë‹¤.</p>

    <div id="quizArea" style="display:none;">
      <div class="meta" id="metaInfo"></div>
      <pre id="questionBox">ë¬¸ì œê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</pre>

      <div class="controls">
        <button id="showAnswerBtn" class="btn-muted">ì •ë‹µ ë³´ê¸°</button>
        <button id="correctBtn" class="btn-success">ë§ìŒ âœ…</button>
        <button id="wrongBtn" class="btn-danger">í‹€ë¦¼ âŒ</button>
        <button id="nextBtn" class="btn-primary">ë‹¤ìŒ â–¶</button>
        <button id="toggleWrongMode" class="btn-muted">í‹€ë¦° ë¬¸ì œë§Œ ë³´ê¸°: ë”</button>
        <button id="shuffleBtn" class="btn-muted">ë‹¤ì‹œ ì„ê¸° ğŸ”€</button>
        <button id="clearWrong" class="btn-muted">í‹€ë¦°ë¬¸ì œ ì´ˆê¸°í™”</button>
        <button id="exportWrong" class="btn-muted">í‹€ë¦°ë¬¸ì œ ë‚´ë³´ë‚´ê¸°(.txt)</button>
      </div>

      <div id="answer" style="display:none;"></div>
      <div class="meta" id="progress"></div>
    </div>
  </div>

<script>
let rawQuestions = [];
let answers = [];
let workList = [];
let currentIndex = 0;
let wrongSet = new Set(JSON.parse(localStorage.getItem('quiz_wrong_list') || '[]'));
let mode = 'all';

const quizArea = document.getElementById('quizArea');
const questionBox = document.getElementById('questionBox');
const answerDiv = document.getElementById('answer');
const showAnswerBtn = document.getElementById('showAnswerBtn');
const correctBtn = document.getElementById('correctBtn');
const wrongBtn = document.getElementById('wrongBtn');
const nextBtn = document.getElementById('nextBtn');
const metaInfo = document.getElementById('metaInfo');
const progress = document.getElementById('progress');
const toggleWrongModeBtn = document.getElementById('toggleWrongMode');
const shuffleBtn = document.getElementById('shuffleBtn');
const clearWrongBtn = document.getElementById('clearWrong');
const exportWrongBtn = document.getElementById('exportWrong');

function splitQuestions(text) {
  const trimmed = text.trim();
  const blocks = [];
  if (/^\s*\d+\./m.test(trimmed)) {
    const parts = trimmed.split(/\n(?=\s*\d+\.)/g);
    for (const p of parts) {
      const m = p.match(/^\s*(\d+)\.\s*/);
      if (m) {
        const num = parseInt(m[1],10);
        const body = p.replace(/^\s*\d+\.\s*/, '').trim();
        blocks.push({num, text: body});
      } else {
        blocks.push({num: blocks.length+1, text: p.trim()});
      }
    }
  } else {
    const lines = trimmed.split(/\r?\n/).map(s => s.trim()).filter(s => s.length>0);
    lines.forEach((ln,i) => blocks.push({num: i+1, text: ln}));
  }
  return blocks;
}

function parseAnswers(text) {
  const lines = text.split(/\r?\n/).map(s => s.trim()).filter(s => s.length>0);
  return lines.map(l => l.replace(/^\s*\d+\.\s*/, '').trim());
}

function shuffle(array) {
  for (let i=array.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

function buildWorkList() {
  workList = rawQuestions.slice();
  shuffle(workList);
  currentIndex = 0;
}

function displayCurrent() {
  answerDiv.style.display = 'none';
  answerDiv.textContent = '';
  quizArea.style.display = 'block';
  if (mode === 'wrong') {
    const wrongArray = workList.filter(q => wrongSet.has(q.num));
    if (wrongArray.length===0) {
      questionBox.textContent = 'ğŸ“š í‹€ë¦° ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.';
      progress.textContent = '';
      metaInfo.textContent = '';
      return;
    }
    const q = wrongArray[currentIndex] || wrongArray[0];
    questionBox.textContent = `${q.num}. ${q.text}`;
    progress.textContent = `${currentIndex+1} / ${wrongArray.length} (í‹€ë¦° ë¬¸ì œë§Œ)`;
    metaInfo.textContent = `ì›ë³¸ ë¬¸ì œ ìˆ˜: ${rawQuestions.length} / í‹€ë¦° ë¬¸ì œ ìˆ˜: ${wrongSet.size}`;
    return;
  }
  if (workList.length===0) return;
  const q = workList[currentIndex];
  questionBox.textContent = `${q.num}. ${q.text}`;
  progress.textContent = `${currentIndex+1} / ${workList.length} (ì „ì²´ ëª¨ë“œ)`;
  metaInfo.textContent = `ì›ë³¸ ë¬¸ì œ ìˆ˜: ${rawQuestions.length} / í‹€ë¦° ë¬¸ì œ ìˆ˜: ${wrongSet.size}`;
}

function getCurrentQuestion() {
  if (mode === 'wrong') {
    const wrongArray = workList.filter(q => wrongSet.has(q.num));
    return wrongArray[currentIndex] || null;
  } else {
    return workList[currentIndex] || null;
  }
}

showAnswerBtn.addEventListener('click', () => {
  const q = getCurrentQuestion();
  if (!q) return;
  answerDiv.style.display = 'block';
  const ans = answers[q.num - 1];
  answerDiv.textContent = ans ? `ì •ë‹µ: ${ans}` : 'ì •ë‹µ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.';
});

correctBtn.addEventListener('click', () => {
  const q = getCurrentQuestion(); if (!q) return;
  wrongSet.delete(q.num); saveWrongSet(); nextQuestion();
});

wrongBtn.addEventListener('click', () => {
  const q = getCurrentQuestion(); if (!q) return;
  wrongSet.add(q.num); saveWrongSet(); nextQuestion();
});

nextBtn.addEventListener('click', nextQuestion);
function nextQuestion() {
  const list = (mode==='wrong') ? workList.filter(q=>wrongSet.has(q.num)) : workList;
  if (list.length===0) return;
  currentIndex = (currentIndex + 1) % list.length;
  displayCurrent();
}

toggleWrongModeBtn.addEventListener('click', () => {
  mode = (mode==='all') ? 'wrong' : 'all';
  toggleWrongModeBtn.textContent = `í‹€ë¦° ë¬¸ì œë§Œ ë³´ê¸°: ${mode==='wrong'?'ì¼¬':'ë”'}`;
  currentIndex = 0;
  displayCurrent();
});

shuffleBtn.addEventListener('click', () => { buildWorkList(); displayCurrent(); });

clearWrongBtn.addEventListener('click', () => {
  if (!confirm('í‹€ë¦° ë¬¸ì œ ê¸°ë¡ì„ ì´ˆê¸°í™”í• ê¹Œìš”?')) return;
  wrongSet = new Set(); saveWrongSet(); displayCurrent();
});

exportWrongBtn.addEventListener('click', () => {
  const list = rawQuestions.filter(q => wrongSet.has(q.num)).map(q => `${q.num}. ${q.text}`);
  const blob = new Blob([list.join('\n\n')], {type:'text/plain;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'í‹€ë¦°ë¬¸ì œ.txt'; a.click();
  URL.revokeObjectURL(url);
});

function saveWrongSet() {
  localStorage.setItem('quiz_wrong_list', JSON.stringify(Array.from(wrongSet)));
}

// âœ… í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ íŒŒì¼ ë¡œë“œ
window.addEventListener("DOMContentLoaded", async () => {
  try {
    const [qRes, aRes] = await Promise.all([
      fetch("ê³µë¶€.txt"),
      fetch("ì •ë‹µ.txt")
    ]);

    if (!qRes.ok || !aRes.ok) {
      questionBox.textContent = "âš ï¸ ê³µë¶€.txt ë˜ëŠ” ì •ë‹µ.txtë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê°™ì€ í´ë”ì— ë‘ì„¸ìš”.";
      return;
    }

    const qText = await qRes.text();
    const aText = await aRes.text();

    rawQuestions = splitQuestions(qText);
    answers = parseAnswers(aText);

    const maxNum = rawQuestions.reduce((m,q)=>Math.max(m,q.num),0);
    while (answers.length < maxNum) answers.push('');

    buildWorkList();
    displayCurrent();
  } catch (err) {
    questionBox.textContent = "íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸° ì¤‘ ì˜¤ë¥˜ ë°œìƒ: " + err;
    console.error(err);
  }
});
</script>
</body>
</html>
