<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<title>ê³µë¶€ í€´ì¦ˆ (ê³µë¶€ + ëª¨ì˜ê³ ì‚¬ í†µí•©)</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  body { font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
         background:#f3f6fb; color:#1f2937; padding:22px; }
  .container{ max-width:900px; margin:24px auto; background:white; padding:22px;
              border-radius:12px; box-shadow:0 6px 24px rgba(16,24,40,0.08); }
  h1{ margin:0 0 10px 0; font-size:22px; }
  .controls{ display:flex; gap:8px; flex-wrap:wrap; margin:12px 0; }
  button{ padding:10px 14px; border-radius:8px; border:0; cursor:pointer; font-weight:600; }
  .btn-primary{ background:#2563eb; color:white; }
  .btn-success{ background:#16a34a; color:white; }
  .btn-danger{ background:#dc2626; color:white; }
  .btn-muted{ background:#e5e7eb; color:#111827; }
  pre{ white-space:pre-wrap; text-align:left; background:#f8fafc; padding:16px; border-radius:8px; font-size:16px; }
  #answer { margin-top:10px; font-weight:700; color:#0f172a; }
  .meta{ font-size:13px; color:#6b7280; margin-top:8px; }
</style>
</head>
<body>
  <div class="container">
    <h1>ğŸ§  NVIDIA ìê²© ëŒ€ë¹„ í€´ì¦ˆ</h1>
    <p class="meta">ê°™ì€ í´ë”ì˜ <code>ê³µë¶€.txt / ì •ë‹µ.txt</code> ë˜ëŠ”
      <code>ëª¨ì˜ê³ ì‚¬_ë¬¸ì œ.txt / ëª¨ì˜ê³ ì‚¬_ì •ë‹µ.txt</code>ë¥¼ ìë™ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.</p>

    <div class="controls">
      <button id="startExamBtn" class="btn-primary">ğŸ ëª¨ì˜ê³ ì‚¬ ì‹œì‘</button>
    </div>

    <div id="quizArea" style="display:none;">
      <div class="meta" id="metaInfo"></div>
      <pre id="questionBox">ë¬¸ì œê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</pre>

      <div class="controls" id="buttonBox">
        <button id="showAnswerBtn" class="btn-muted">ì •ë‹µ ë³´ê¸°</button>
        <button id="correctBtn" class="btn-success">ë§ìŒ âœ…</button>
        <button id="wrongBtn" class="btn-danger">í‹€ë¦¼ âŒ</button>
        <button id="nextBtn" class="btn-primary">ë‹¤ìŒ â–¶</button>
        <button id="toggleWrongMode" class="btn-muted">í‹€ë¦° ë¬¸ì œë§Œ ë³´ê¸°: ë”</button>
        <button id="shuffleBtn" class="btn-muted">ë‹¤ì‹œ ì„ê¸° ğŸ”€</button>
        <button id="clearWrong" class="btn-muted">í‹€ë¦°ë¬¸ì œ ì´ˆê¸°í™”</button>
        <button id="exportWrong" class="btn-muted">í‹€ë¦°ë¬¸ì œ ë‚´ë³´ë‚´ê¸°(.txt)</button>
      </div>

      <div id="answer" style="display:none;"></div>
      <div class="meta" id="progress"></div>
    </div>
  </div>

<script>
let rawQuestions = [];
let answers = [];
let workList = [];
let currentIndex = 0;
let wrongSet = new Set(JSON.parse(localStorage.getItem('quiz_wrong_list') || '[]'));
let mode = 'all';
let examMode = false;
let examIndex = 0;
let score = 0;

const quizArea = document.getElementById('quizArea');
const questionBox = document.getElementById('questionBox');
const answerDiv = document.getElementById('answer');
const showAnswerBtn = document.getElementById('showAnswerBtn');
const correctBtn = document.getElementById('correctBtn');
const wrongBtn = document.getElementById('wrongBtn');
const nextBtn = document.getElementById('nextBtn');
const metaInfo = document.getElementById('metaInfo');
const progress = document.getElementById('progress');
const toggleWrongModeBtn = document.getElementById('toggleWrongMode');
const shuffleBtn = document.getElementById('shuffleBtn');
const clearWrongBtn = document.getElementById('clearWrong');
const exportWrongBtn = document.getElementById('exportWrong');
const startExamBtn = document.getElementById('startExamBtn');
const buttonBox = document.getElementById('buttonBox');

// âœ… ë¬¸ì œ í…ìŠ¤íŠ¸ íŒŒì‹± (ë³´ê¸° í¬í•¨)
function splitQuestions(text) {
  const trimmed = text.trim();
  const lines = trimmed.split(/\r?\n/);
  const questions = [];
  let current = '';

  for (const line of lines) {
    if (/^\s*\d+\./.test(line)) {
      if (current.trim()) questions.push(current.trim());
      current = line;
    } else {
      current += '\n' + line;
    }
  }
  if (current.trim()) questions.push(current.trim());
  // ğŸ”½ ì—¬ê¸°ë§Œ ìˆ˜ì •
  return questions.map((q) => {
    const match = q.match(/^\s*(\d+)\./);
    const num = match ? parseInt(match[1]) : null;
    return { num, text: q };
  });
}

// âœ… ì •ë‹µ í…ìŠ¤íŠ¸ íŒŒì‹±
function parseAnswers(text) {
  const lines = text.split(/\r?\n/).map(s => s.trim()).filter(s => s.length>0);
  return lines.map(l => l.replace(/^\s*\d+\.\s*/, '').trim());
}

function shuffle(array) {
  for (let i=array.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

function buildWorkList() {
  workList = rawQuestions.slice();
  shuffle(workList);
  currentIndex = 0;
}

function displayCurrent() {
  answerDiv.style.display = 'none';
  answerDiv.textContent = '';
  quizArea.style.display = 'block';
  if (mode === 'wrong') {
    const wrongArray = workList.filter(q => wrongSet.has(q.num));
    if (wrongArray.length===0) {
      questionBox.textContent = 'ğŸ“š í‹€ë¦° ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.';
      progress.textContent = '';
      metaInfo.textContent = '';
      return;
    }
    const q = wrongArray[currentIndex] || wrongArray[0];
    questionBox.textContent = `${q.num}. ${q.text}`;
    progress.textContent = `${currentIndex+1} / ${wrongArray.length} (í‹€ë¦° ë¬¸ì œë§Œ)`;
    metaInfo.textContent = `ì „ì²´ ë¬¸ì œ: ${rawQuestions.length} / í‹€ë¦° ë¬¸ì œ: ${wrongSet.size}`;
    return;
  }
  if (workList.length===0) return;
  const q = workList[currentIndex];
  questionBox.textContent = `${q.num}. ${q.text}`;
  progress.textContent = `${currentIndex+1} / ${workList.length} (ì „ì²´ ëª¨ë“œ)`;
  metaInfo.textContent = `ì „ì²´ ë¬¸ì œ: ${rawQuestions.length} / í‹€ë¦° ë¬¸ì œ: ${wrongSet.size}`;
}

function getCurrentQuestion() {
  if (mode === 'wrong') {
    const wrongArray = workList.filter(q => wrongSet.has(q.num));
    return wrongArray[currentIndex] || null;
  } else {
    return workList[currentIndex] || null;
  }
}

// âœ… ì •ë‹µ ë³´ê¸°
showAnswerBtn.addEventListener('click', () => {
  if (examMode) return;
  const q = getCurrentQuestion();
  if (!q) return;
  answerDiv.style.display = 'block';
  const ans = answers[q.num - 1];
  answerDiv.textContent = ans ? `ì •ë‹µ: ${ans}` : 'ì •ë‹µ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.';
});

correctBtn.addEventListener('click', () => {
  if (examMode) return;
  const q = getCurrentQuestion(); if (!q) return;
  wrongSet.delete(q.num); saveWrongSet(); nextQuestion();
});

wrongBtn.addEventListener('click', () => {
  if (examMode) return;
  const q = getCurrentQuestion(); if (!q) return;
  wrongSet.add(q.num); saveWrongSet(); nextQuestion();
});

nextBtn.addEventListener('click', nextQuestion);
function nextQuestion() {
  const list = (mode==='wrong') ? workList.filter(q=>wrongSet.has(q.num)) : workList;
  if (list.length===0) return;
  currentIndex = (currentIndex + 1) % list.length;
  displayCurrent();
}

toggleWrongModeBtn.addEventListener('click', () => {
  if (examMode) return;
  mode = (mode==='all') ? 'wrong' : 'all';
  toggleWrongModeBtn.textContent = `í‹€ë¦° ë¬¸ì œë§Œ ë³´ê¸°: ${mode==='wrong'?'ì¼¬':'ë”'}`;
  currentIndex = 0;
  displayCurrent();
});

shuffleBtn.addEventListener('click', () => { if (!examMode){ buildWorkList(); displayCurrent(); } });
clearWrongBtn.addEventListener('click', () => {
  if (examMode) return;
  if (!confirm('í‹€ë¦° ë¬¸ì œ ê¸°ë¡ì„ ì´ˆê¸°í™”í• ê¹Œìš”?')) return;
  wrongSet = new Set(); saveWrongSet(); displayCurrent();
});
exportWrongBtn.addEventListener('click', () => {
  if (examMode) return;
  const list = rawQuestions.filter(q => wrongSet.has(q.num)).map(q => `${q.num}. ${q.text}`);
  const blob = new Blob([list.join('\n\n')], {type:'text/plain;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'í‹€ë¦°ë¬¸ì œ.txt'; a.click();
  URL.revokeObjectURL(url);
});
function saveWrongSet() {
  localStorage.setItem('quiz_wrong_list', JSON.stringify(Array.from(wrongSet)));
}

// âœ… ê³µë¶€ / ëª¨ì˜ê³ ì‚¬ íŒŒì¼ ìë™ ë¡œë“œ
window.addEventListener("DOMContentLoaded", async () => {
  await loadFiles(false); // ê¸°ë³¸ ê³µë¶€ ëª¨ë“œ
});

// ğŸ“‚ íŒŒì¼ ë¡œë“œ í•¨ìˆ˜
async function loadFiles(isExam = false) {
  const filePrefix = isExam ? "ëª¨ì˜ê³ ì‚¬_" : "";
  try {
    const [qRes, aRes] = await Promise.all([
      fetch(`${filePrefix}ë¬¸ì œ.txt`),
      fetch(`${filePrefix}ì •ë‹µ.txt`)
    ]);
    if (!qRes.ok || !aRes.ok) {
      questionBox.textContent = `âš ï¸ ${filePrefix}ê³µë¶€.txt ë˜ëŠ” ${filePrefix}ì •ë‹µ.txtë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`;
      return;
    }
    const qText = await qRes.text();
    const aText = await aRes.text();
    rawQuestions = splitQuestions(qText);
    answers = parseAnswers(aText);

    if (isExam) startExamMode();
    else { buildWorkList(); displayCurrent(); }
  } catch (err) {
    questionBox.textContent = "íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜: " + err;
  }
}

// ğŸ ëª¨ì˜ê³ ì‚¬ ì‹œì‘
startExamBtn.addEventListener('click', async () => {
  if (!confirm("ëª¨ì˜ê³ ì‚¬ë¥¼ ì‹œì‘í• ê¹Œìš”? (50ë¬¸í•­ ëœë¤)")) return;
  await loadFiles(true);
});

// ğŸ§® ëª¨ì˜ê³ ì‚¬ ëª¨ë“œ
function startExamMode() {
  examMode = true;
  quizArea.style.display = 'block';
  buttonBox.style.display = 'none';
  workList = rawQuestions.slice(0, 50);
  shuffle(workList);
  examIndex = 0;
  score = 0;
  showExamQuestion();
}

function showExamQuestion() {
  const q = workList[examIndex];
  questionBox.textContent = `${examIndex + 1}. ${q.text}`;
  answerDiv.style.display = 'none';
  progress.textContent = `ë¬¸í•­ ${examIndex + 1} / ${workList.length}`;
  metaInfo.textContent = `í˜„ì¬ ì ìˆ˜: ${score}`;
}

// ìˆ«ìí‚¤(1~4)ë¡œ ë‹µ ì…ë ¥
document.addEventListener("keydown", (e) => {
  if (!examMode) return;
  if (e.key >= "1" && e.key <= "4") {
    const q = workList[examIndex];
    const correct = answers[q.num - 1];
    const isCorrect = q.text.includes(correct);
    if (isCorrect) score++;
    examIndex++;
    if (examIndex >= workList.length) showExamResult();
    else showExamQuestion();
  }
});

function showExamResult() {
  const percent = (score / workList.length * 100).toFixed(1);
  questionBox.textContent = `âœ… ì‹œí—˜ ì¢…ë£Œ!\në‹¹ì‹ ì˜ ì ìˆ˜: ${score} / ${workList.length} (${percent}%)`;
  answerDiv.textContent = percent >= 90 ? "ğŸ‰ ë§Œì  ìˆ˜ì¤€!" :
                          percent >= 70 ? "ğŸ‘ í•©ê²© ê°€ëŠ¥" :
                          "âš ï¸ ì¶”ê°€ ë³µìŠµ í•„ìš”";
  answerDiv.style.display = "block";
}
</script>
</body>
</html>
